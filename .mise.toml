[tasks.help]
description = "Show available tasks"
run = """
echo "Available tasks:"
echo "  mise run install   - Install development dependencies"
echo "  mise run lint      - Run all linting tools"
echo "  mise run build     - Build the Ansible collection"
echo "  mise run test      - Run syntax checks and tests"
echo "  mise run clean     - Clean build artifacts"
"""

[tasks.install]
description = "Install development dependencies"
run = """
echo "Installing dependencies..."
pip install --user -r requirements.txt
if command -v npm >/dev/null 2>&1; then
    npm install
else
    echo "Node.js not found, skipping npm install"
fi
"""

[tasks.lint]
description = "Run all linting tools"
run = """
echo "Running linting tools..."
if command -v ansible-lint >/dev/null 2>&1; then
    ansible-lint
else
    echo "ansible-lint not found, skipping"
fi
if command -v yamllint >/dev/null 2>&1; then
    yamllint .
else
    echo "yamllint not found, skipping"
fi
if command -v npm >/dev/null 2>&1 && [ -f package.json ]; then
    npm run lint:markdown
else
    echo "npm or package.json not found, skipping markdown lint"
fi
"""

[tasks.build]
description = "Build the Ansible collection"
run = """
echo "Building collection..."
mkdir -p build
ansible-galaxy collection build ansible_collections/basher83/komodo/ --output-path ./build/ --force
"""

[tasks.test]
description = "Run syntax checks and tests"
depends = ["build"]
run = """
echo "Running syntax checks..."
ansible-playbook --syntax-check ansible_collections/basher83/komodo/playbooks/install.yml
echo "Running collection validation..."
ansible-galaxy collection install ./build/basher83-komodo-*.tar.gz --force
"""

[tasks.clean]
description = "Clean build artifacts"
run = """
echo "Cleaning build artifacts..."
rm -rf build/
rm -f *.tar.gz
rm -rf node_modules/
"""